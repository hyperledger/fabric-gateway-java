# Copyright IBM Corp. All Rights Reserved.
#
# SPDX-License-Identifier: Apache-2.0

trigger:
- master

pool:
  vmImage: 'ubuntu-latest'

variables:
  ORG_HYPERLEDGER_FABRIC_SDK_PROPOSAL_WAIT_TIME: '55000'
  ORG_HYPERLEDGER_FABRIC_SDK_CHANNELCONFIG_WAIT_TIME: '20000'
  ORG_HYPERLEDGER_FABRIC_SDK_CLIENT_TRANSACTION_CLEANUP_UP_TIMEOUT_WAIT_TIME: '65000'
  ORG_HYPERLEDGER_FABRIC_SDK_ORDERER_ORDERERWAITTIMEMILLISECS: '180000'
  ORG_HYPERLEDGER_FABRIC_SDK_PEER_EVENTREGISTRATION_WAIT_TIME: '180000'
  ORG_HYPERLEDGER_FABRIC_SDK_EVENTHUB_CONNECTION_WAIT_TIME: '180000'
  ORG_HYPERLEDGER_FABRIC_SDK_CHANNEL_GENESISBLOCK_WAIT_TIME: '180000'

steps:
- script: |
    ########################
    # Pull images from nexus and re-tag to latest
    #######################
    for IMAGE in peer orderer ca baseos ccenv javaenv nodeenv tools; do
        docker pull nexus3.hyperledger.org:10001/hyperledger/fabric-$IMAGE:amd64-2.0.0-stable
        docker tag nexus3.hyperledger.org:10001/hyperledger/fabric-$IMAGE:amd64-2.0.0-stable hyperledger/fabric-$IMAGE:amd64-latest
        docker tag nexus3.hyperledger.org:10001/hyperledger/fabric-$IMAGE:amd64-2.0.0-stable hyperledger/fabric-$IMAGE
    done
    ##########
    mvn clean install
